{% extends "base.html" %}
{% load i18n %}
{% block title %}{% trans "Settings" %}{% endblock %}
{% block content %}
<div class="container py-5">
  <h3 class="mb-4">{% trans "Settings" %}</h3>
  <form method="post" action="{% url 'update_settings' %}">
    {% csrf_token %}


    <!-- Language & Currency -->
    <div class="card border-0 shadow-sm mb-3">
      <div class="card-body">
        <h5 class="mb-3">{% trans "Locale" %}</h5>

        <div class="mb-3">
          <label class="form-label">{% trans "Language" %}</label>
          <select name="language" class="form-select">
            {% for code, name in LANG_CHOICES %}
              <option value="{{ code }}" {% if code == language %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label class="form-label">{% trans "Currency" %}</label>
          <select name="currency" class="form-select">
            {% for c in CURR_CHOICES %}
              <option value="{{ c }}" {% if c == currency %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
    </div>

    <button class="btn btn-primary">{% trans "Save Settings" %}</button>
  </form>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  // Live preview for theme (before Save)
  (function(){
    function apply(theme){
      if (theme === "auto") {
        localStorage.removeItem("theme");
        const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        document.documentElement.setAttribute("data-bs-theme", prefersDark ? "dark" : "light");
      } else {
        localStorage.setItem("theme", theme);
        document.documentElement.setAttribute("data-bs-theme", theme);
      }
    }
    // apply current
    const current = document.querySelector('input[name="theme"]:checked')?.value || "auto";
    apply(current);
    // listen
    document.querySelectorAll('input[name="theme"]').forEach(r => {
      r.addEventListener("change", () => apply(r.value));
    });
  })();
</script>
{% endblock %}
